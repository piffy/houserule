=provide(:title, 'Eventi')
%h1 Elenco eventi


= form_tag events_path, :method => :get, :id => 'filter_form',:html => {:class => "form-horizontal"} do
  %span{:class =>"label label-info" }
    = radio_button_tag 'selection', 'all_events', @selection=='all_events'
    Tutti
    %span{:class =>"label label-info" }
    = radio_button_tag 'selection', 'not_begun', @selection=='not_begun'
    Non iniziati
  %br
  = submit_tag 'Aggiorna', :id => 'filter_submit', :class=> "btn btn-small"

=will_paginate

%table{:class => "table table-striped"}
  %tr
    %th{:class => @name_header}= link_to 'Nome evento', events_path(:sort => 'name'), :id => 'name_header'
    %th{:class => @system_header}= link_to 'Sistema', events_path(:sort => 'system'), :id => 'system_header'
    %th{:class => @begins_at_header}= link_to 'Data e ora', events_path(:sort => 'begins_at'), :id => 'begins_at_header'
    %th Durata
    %th Conferma?
    %th Luogo
    %th Prenotati
    %th
    %th
    %th

  - @events.each do |event|
    %tr
      %td= link_to event.name, event, :title => event.descr_short
      %td= event.system
      %td= l(event.begins_at, :format => :medium)
      %td= event.duration
      %td
        -if event.begins_at==event.deadline
          No
        -else
          =l(event.deadline, :format => :short)
      %td= event.location
      %td
        = event.reservations.count
        = " / "  + event.max_player_num.to_s unless event.max_player_num ==0
      -unless event.invite_only? ||  event.reservation_locked?
        -if !@current_user.nil? && event.already_reserved_by(@current_user)
          %td= link_to 'Sprenota', event_reservation_path(event, event.already_reserved_by(@current_user)), :class =>"btn btn-danger"
        -else
          %td
            = link_to 'Prenota', new_event_reservation_path(event), :class =>"btn btn-primary"
      %td
        -if !@current_user.nil? && @current_user==event.user
          = link_to 'Modifica', edit_event_path(event), :class =>"btn"

= will_paginate
%br

= link_to 'Organizza evento', new_event_path, :class =>"btn"
